# WebRTC

- WebRTC(Web Real-Time Communications)
- 웹, 앱에서 별 다른 소프트웨어 없이, 카메라, 마이크 등을 사용해서 실시간 커뮤니케이션을 제공해주는 기술
- 우리가 잘 알고있는 화상통화, 화상 공유들을 구현할 수 있는 오픈소스
- 비디오, 음성 및 일반 데이터가 P2P방식으로 피어간의 전송되도록 지원
- JavaScript API로 제공
- 용어 및 개념
  - DataStream, STUN / TURN servers, signaling, JSEP, ICE, SIP, SDP, NAT, UDP/TCP, network socket 등

<br>

## WebRTC의 장점과 단점
### 장점
1. Latency가 짧다.  
우리가 흔히 알고있는 인스타라이브, 유튜브라이브, 트위치 등은 RTMP를 사용하여 실시간 스트리밍을 하고 있다. RTMP보다 WebRTC는 낮은 Latency를 가지고 있고 거의 지연시간 없는 REAL-TIME과 비슷한 방송을 할 수 있다.

2. 별 다른 소프트웨어 없이 실시간 커뮤니티가 가능하다.  
웹/앱으로 방송을 키고 싶을 때, 별도의 플러그 인이나 미디어 송출 관련 소프트웨어를 따로 설치할 필요가 없다.

3. 개발 진입장벽이 낮다.

4. 무료

### 단점
1. 크로스 브라우징 문제  
WebRTC는 현재 크롬, 오페라, 파이어폭스 뿐만 아니라 안드로이드, iOS등 브라우저, 앱에서 활용할 수 있다. 그러나 사람들이 잘 사용하지 않는 브라우저나 최신 버전을 사용하지 않는 사용자는 사용이 불가능하다는 단점이 있다.  

2. STUN/TURN 서버 필요  
Peer to Peer 통신을 하기 위해서는 사용자의 IP주소를 알아야한다. 하지만, 대부분의 사용자는 방화벽등을 사용하고 다른 네트워크 상에서 연결이 이루어지기 위해서는 STUN/TURN 서버가 꼭 필요하다.

<br>

## WebRTC의 통신원리
- Peer to Peer communication(P2P통신)
  - Peer to Peer 방식은 동등 계층간 통신방식으로 클라이언트, 서버의 개념없이 동등한 노드들로 구성되어 데이터를 주고받는 형식으로 되어있다.

<br>

## 용어
- data streams : 연결 지향통신에서 연속적으로 흘러나오는 데이터들의 흐름. 데이터의 양이 한정되어 있지않고 끊임없이 생성되고 변하는 데이터의 흐름  

- NAT(Network Address Translation) : NAT는 네트워크 주소 변환으로 IP패킷의 TCP/UDP 포트 숫자와 소스 및 목적지의 IP주소 등을 재기록하면서 네트워크 트래픽을 주고 받는 기술이다.  

- Signaling : 시그널링은 P2P통신이 일어나기 전에 세션 제어 메시지, 네트워크 구성, 미디어 기능 등의 정보를 교환하는데 사용한다.  
시그널링은 P2P 스트리밍을 시작하기 전에 성공적으로 완료되어야 한다.
  - 세션 제어 메세지 : 통신을 초기화하거나 닫고 오류를 보고
  - 네트워크 구성 : 외부 세계에 컴퓨터의 IP 주소와 포트는 무엇인지 파악
  - 미디어 기능 : 브라우저와 통신하려는 브라우저에서 처리할 수 있는 코덱과 해상도는 무엇인지 파악

- SDP : Session Description Protocol

- JSEP : JSEP(JavaScript Session Establishment Protocol)제안/응답 아키텍처
- ![](https://miro.medium.com/max/4800/1*Lhsz8eckhNrXDehMo2hQyA.webp)


- TCP와 UDP
  - **TCP(Transmission Control Protocol, 전송제어 프로토콜)** 는 신뢰성이 없는 인터넷을 통해 종단간에 신뢰성 있는 **바이트 스트림** 을 전송하도록 설계되었다. TCP 서비스는 송신자와 수신자 모두 소켓이라고 부르는 종단점을 생성함으로써 이루어진다. TCP에서 연결 설정(connection establishment)은 **<u>3-way handshake</u>** 를 통해 행해진다.  
  모든 TCP 연결은 전이중(full-duplex), 점대점(point to point)방식이다. 전이중이란 전송이 양방향으로 동시에 일어날 수 있음을 의미하며 점대점이란 각 연결이 정확히 2개의 종단점을 가지고 있음을 의미한다. TCP는 멀티캐스팅이나 브로드캐스팅을 지원하지 않는다.

     - **<u>3-way handshake</u>**  
    TCP/IP 프로토콜을 이용해서 통신을 하는 응용프로그램이 데이터를 전송하기 전에 먼저 정확한 정송을 보장하기 위해 상대방의 컴퓨터와 사전에 세션을 미리 수립하는 과정을 의미한다.  
    양쪽 모두 데이터를 전송할 준비가 되었다는 것을 보장하고, 실제로 데이터를 전달하기 전에 한쪽이 다른 쪽이 준비되었다는 것을 알 수 있도록 한다.
    1. A클라이언트는 B서버에 접속을 요청하는 SYN 패킷을 보낸다. 이때 A클라이언트는 SYN을 보내고 SYN/ACK 응답을 기다리는 SYN_SENT 상태가 된다.
    2. B서버는 SYN요청을 받고 A클라이언트에게 요청을 수락한다는 ACK 와 SYN flag가 설정된 패킷을 발송하고 A가 다시 ACK으로 응답하기를 기다린다. 이때 B서버는 SYN_RECEIVED 상태가 된다.
    3. A클라이언트는 B서버에게 ACK를 보내고 이후로부터는 연결이 이루어지고 데이터가 송수신 된다. 이때 B서버 상태가 ESTABLISHED이다.  
   
    <br>
   - **UDP(User Datagram Protocol, 사용자 데이터그램 프로토콜)** 는 **비연결성 프로토콜** 이다. IP 데이터그램을 캡슐화해서 보내는 방법과 연결 설정을 하지 않고 보내는 방법을 제공한다. UDP는 흐름제어, 오류제어, 또는 손상된 세그먼트의 수신에 대한 재전송을 하지 않는다. UDP가 행하는 것은 포트들을 사용하여 IP 프로토콜에 인터페이스를 제공하는 것이다.  
   UDP를 사용한 것들에는 DNS가 있다. 어떤 호스트 네임의 IP 주소를 찾을 필요가 있는 프로그램은, DNS 서버로 호스트 네임을 포함한 UDP 패킷을 보낸다. 이 서버는 호스트의 IP 주소를 포함한 UDP 패킷으로 응답한다. 사전에 설정이 필요하지 않으며 그 후에 해제가 필요하지 않다.

<br>

[참고자료]  
https://gh402.tistory.com/38