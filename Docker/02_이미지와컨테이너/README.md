# Section 02

컨테이너는 애플리케이션, 웹사이트, 노드 서버, 애플리케이션을 실행하는 전체 환경 등, 무엇이든 포함하는 작은 패키지

이미지는 모든 설정 명령과 모든 코드가 포함된 공유 가능한 패키지이며 컨테이너는 그러한 이미지의 구체적인 실행 인스턴스이다.  
즉, 이미지를 기반으로 하는 여러 컨테이너를 실행할 수 있다.

이미지 : 청사진  
템플릿 : 코드와 애플리케이션을 포함  
컨테이너 : 실행 애플리케이션

### 이미지를 생성하고 가져오는 2가지 방법

1. 이미 존재하는 이미지를 사용

   - 동료가 만듦
   - 매우 일반적이어서 미리 구축된 공식 이미지나 커뮤티니에서 공유한 이미지(dockerhub)
   - docker run node
     - 노드 이미지를 사용 및 활용하여 이 이미지를 기반으로하는 컨테이너를 생성
     - docker ps -a 로 도커가 생성한 모든 컨테이너와 프로세스 확인
   - docker run -it node
     - 도커에게 컨테이너 내부에서 호스팅 머신으로 대화형 세션을 노출하고 싶다고 알리는 것 -> 인터렉티브 노드 터미널 접속
   - docker 내부의 노드 버전은 v19.5.0. 이나 현재 pc에 설치된 버전은 v18.12.1이다. 이를 보면 컨테이너 내부의 버전이 따로 있고, 노드 컨테이너를 실행하고, 상호 작용하기 위해 시스템에 노드를 설치할 필요가 없다는 것을 알 수 있다.

2. npm install로 node_module설치 후 사용

이미지는 기본적으로 잠겨있고 변경사항을 업데이트 하지 못한다.  
업데이트를 위해서는 이미지를 다시 빌드해야한다.

이미지를 빌드할 때 마다 도커는 모든 명령 결과를 캐시하고 이미지를 다시 빌드할 때 명령을 다시 실행할 필요가 없다면 캐시된 결과를 사용한다.  
이것을 **레이어 기반 아키텍쳐** 라고 한다.  
모든 명령은 Dockerfile의 레이어를 나타낸다.

한 레이어가 변경될 때 마다, 후속 레이어도 다시 실행된다.

따라서 다음과 같이 도커파일을 변경하게 되면 성능 최적화가 가능하다.  
파일이 변경되더라도 npm install 레이어 뒤에 COPY . /app이 있으므로 npm install은 다시 실행되지 않는다.

```docker

FROM node

WORKDIR /app

COPY package.json /app

RUN npm install

COPY . /app

EXPOSE 80

CMD ["node", "server.js"]
```

- docker --help : 도커명령어모음
- docker start [종료된 컨테이너 이름]
  - 이미 종료된 컨테이너를 다시 실행시킴
  - 터미널 계속 사용가능(detached 모드)
- attached 모드는 단순히 그 컨테이너의 출력결과를 수신
- docker run -p 8000:80 -d c313ac706276 과 같이 -d 를 추가하여 detached 모드로 시작
- docker attached [컨테이너 이름] 으로 attached모드 전환
- docker logs [이름] : 해당 컨테이너에 의해 출력된 과거의 로그를 볼 수 있다.
- docker logs -f [이름] : 해당 컨테이너 출력 수신모드
